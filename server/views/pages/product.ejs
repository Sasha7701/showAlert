<style>
	.ProductForm-preview {
		position: relative;
		width: 100%;
		padding-top: 100%;
		box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
	}

	.ProductForm-preview-image {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
	}
	.ProductForm-buttons {
		padding-top: 20px;
		margin-top: 20px;
		border-top: 1px solid #EEE;
	}
	.ProductForm-buttons .button {
		max-width: 120px;
		width: 100%;
	}
</style>

<form class="ProductForm box" method="post">
	<div class="field">
		<input
			class="input is-large"
			value="<%- product.name %>"
			name="name"
			placeholder="Display name"
			maxlength="100"
		/>
	</div>

	<div class="columns">
		<div class="column is-one-quarter">
			<div class="ProductForm-preview">
				<img
					id="image-el"
					class="ProductForm-preview-image"
					src="<%- product.image %>"
				/>
			</div>
		</div>
		<div class="column">
			<div class="field">
				<input
					id="image-input"
					class="input"
					value="<%- product.image %>"
					name="image"
					placeholder="Image URL"
				/>
				<div class="help">
					If you have the image you want to upload, use
					<a href="https://imgur.com/" target="_blank">imgur</a>
					for free hosting. Make sure the URL you paste has a file type
					at the end (.jpg, .png, etc.)
				</div>
			</div>
		</div>
	</div>

	<div class="columns">
		<div class="column">
			<div class="field has-addons">
				<div class="control">
					<a class="button is-static">
						$
					</a>
				</div>
				<div class="control">
					<input
						class="input"
						value="<%- product.price %>"
						name="price"
						placeholder="Price"
						type="number"
						step="0.01"
					/>
				</div>
			</div>
		</div>

		<div class="column">
			<div class="field">
				<input
					class="input"
					value="<%- product.category %>"
					name="category"
					placeholder="Category"
					list="categories"
				/>
			</div>
		</div>

		<div class="column">
			<div class="field">
				<input
					class="input"
					value="<%- product.rating %>"
					name="rating"
					placeholder="Rating (1-10, optional)"
					type="number"
					step="1"
					min="1"
					max="10"
				/>
			</div>
		</div>
	</div>

	<div class="field">
		<textarea
			class="textarea"
			name="description"
			rows="4"
			placeholder="Description"
		><%- product.description %></textarea>
	</div>

	<div class="field">
		<div class="label">
			Product Specs (Optional)
			<button
				id="add-spec"
				class="ProductForm-addSpec button is-success is-outlined is-small"
				type="button"
			>
				+ Add spec
			</button>
		</div>
		<div id="spec-list">
			<div class="columns">
				<div class="column">
					<div class="field">
						<input
							class="input"
							name="specLabel"
							placeholder="Label"
						/>
					</div>
				</div>
				<div class="column">
					<div class="field">
						<input
							class="input"
							name="specValue"
							placeholder="Value"
						/>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="ProductForm-buttons">
		<button class="button is-success is-medium" type="submit">
			Save
		</button>
		<% if (product.id) { %>
			<button class="button is-error is-medium" type="submit" name="delete" value="1">
				Delete
			</button>
		<% } %>
	</div>
</form>

<script>
	const imageEl = document.getElementById("image-el");
	const imageInput = document.getElementById("image-input");
	const addSpecBtn = document.getElementById("add-spec");
	const specList = document.getElementById("spec-list");

	imageInput.addEventListener("change", (ev) => {
		const url = ev.target.value;
		setTimeout(() => {
			if (imageInput.value === url) {
				imageEl.src = url;
			}
		}, 300);
	});

	addSpecBtn.addEventListener("click", () => {
		const newFields = `
			<div class="columns">
				<div class="column">
					<div class="field">
						<input
							class="input"
							name="specLabel"
							placeholder="Label"
						/>
					</div>
				</div>
				<div class="column">
					<div class="field">
						<input
							class="input"
							name="specValue"
							placeholder="Value"
						/>
					</div>
				</div>
			</div>
		`;

		specList.insertAdjacentHTML('beforeend', newFields);
	});

</script>
